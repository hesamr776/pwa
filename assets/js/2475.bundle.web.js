(self.webpackChunknakhlex=self.webpackChunknakhlex||[]).push([[2475],{22475:function(e,t,l){var n=l(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(l(6479)),u=n(l(67154)),a=n(l(63038)),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var l=N(t);if(l&&l.has(e))return l.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var a=r?Object.getOwnPropertyDescriptor(e,u):null;a&&(a.get||a.set)?Object.defineProperty(n,u,a):n[u]=e[u]}return n.default=e,l&&l.set(e,n),n}(l(67294)),s=l(39698),o=l(59693),f=l(62484),c=l(51222),d=l(4438),m=l(9033),_=["side","userId","kycLevel","navigation","getAdvertisePaymentMethods","onPress"],b=this,v="/Users/phinix/Workspace/BitBayt/src/features/P2P/screens/AdvertisesList.tsx";function N(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,l=new WeakMap;return(N=function(e){return e?l:t})(e)}t.default=function(e){var t=e.navigation,l=e.route,n=l.params.side,r=i.default.useState(),_=(0,a.default)(r,2),N=_[0],g=_[1],P=i.default.useState(!1),h=(0,a.default)(P,2),M=h[0],x=h[1],E=i.default.useState(!1),k=(0,a.default)(E,2),A=k[0],I=k[1],w=i.default.useRef(null),C=(0,m.useStore)().user,D=C.id,O=C.kycLevel,S=i.default.useState([{key:"buy",title:(0,s.$t)("buy")},{key:"sell",title:(0,s.$t)("sell")}]),L=(0,a.default)(S,1)[0],W=(0,c.useUserExternalWalletsApi)().data,j=(0,d.useExternalWallets)(W),V=j.paymentMethods,T=j.userWallets.userPaymentMethods,B=(0,i.useCallback)((function(e){return V.filter((function(t){var l;return null==e||null==(l=e.externalWalletIds)?void 0:l.includes(t.value)}))}),[V]),$=(0,i.useCallback)((function(e){return B(e).filter((function(e){return T.find((function(t){return t.externalWalletId===e.value}))}))}),[B,T]),F=function(e,t,l,n){var r;if(!t)if(e)if("sell"!==n||O)if(l){var u;null==(u=w.current)||u.open()}else I(!0);else x(!0);else null==(r=w.current)||r.close()};return i.default.createElement(o.Screen,{noPadding:!0,__self:b,__source:{fileName:v,lineNumber:103,columnNumber:5}},i.default.createElement(o.Tabs,{activeIndex:"sell"===n?1:0,scenes:p({userId:D,kycLevel:O,onPress:function(e,t,l){g(e),F(!0,t,$(e).length>0,l)},getAdvertisePaymentMethods:B,navigation:t,route:l}),routes:L,__self:b,__source:{fileName:v,lineNumber:104,columnNumber:7}}),i.default.createElement(o.BottomSheet,{ref:w,size:"xl",title:(0,s.$t)("buy"===(null==N?void 0:N.side)?"sell":"buy")+" USDT",noPadding:!0,__self:b,__source:{fileName:v,lineNumber:125,columnNumber:7}},N&&i.default.createElement(f.ConfirmP2POrderForm,(0,u.default)({navigation:t,route:l,setModalVisible:function(e){return F(e)}},N,{commonPaymentMethods:$(N),side:"buy"===(null==N?void 0:N.side)?"sell":"buy",__self:b,__source:{fileName:v,lineNumber:131,columnNumber:11}}))),i.default.createElement(o.Popup,{isVisible:A,code:"ADD_PAYMENT_METHOD",extraData:{advertisePaymentMethods:B(N)},InsideComponent:y,onRequestClose:function(e){var l=e.isAccepted;I(!1),l&&t.navigate("Settings",{redirectTo:"PaymentMethods"})},__self:b,__source:{fileName:v,lineNumber:142,columnNumber:7}}),i.default.createElement(o.Popup,{isVisible:M,code:"KYC",onRequestClose:function(e){var l=e.isAccepted;x(!1),l&&t.navigate("Settings",{redirectTo:"Profile"})},__self:b,__source:{fileName:v,lineNumber:157,columnNumber:7}}))};var y=function(e){return e.advertisePaymentMethods.map((function(e){return i.default.createElement(o.View,{flexDirection:"row",alignItems:"center",key:"advertise-payment-method_"+e.value,__self:b,__source:{fileName:v,lineNumber:174,columnNumber:5}},i.default.createElement(o.Image,{source:{uri:e.icon},width:20,height:20,margin:"xs",__self:b,__source:{fileName:v,lineNumber:178,columnNumber:7}}),i.default.createElement(o.Text,{color:"gray1",__self:b,__source:{fileName:v,lineNumber:179,columnNumber:7}},e.label))}))},g=function(e){var t=e.side,l=e.userId,n=e.kycLevel,a=e.navigation,d=e.getAdvertisePaymentMethods,m=e.onPress,N=(0,r.default)(e,_),y="buy"===t?"sell":"buy",g=(0,c.useAllAdvertisesApi)(y),p=g.data,P=void 0===p?{pages:[]}:p,h=g.isFetching,M=g.isLoading,x=g.hasNextPage,E=g.fetchNextPage,k=g.isFetchingNextPage;return i.default.createElement(o.View,{flex:1,justifyContent:"center",testID:"AdvertisesScreen",paddingHorizontal:"m",__self:b,__source:{fileName:v,lineNumber:217,columnNumber:5}},M&&i.default.createElement(o.Loading,{__self:b,__source:{fileName:v,lineNumber:222,columnNumber:21}}),(0,o.List)({data:null==P?void 0:P.pages.flat().filter((function(e){return l===e.userId||"buy"===t||+e.lowLimit<=+((null==e?void 0:e.value)||"0")-+((null==e?void 0:e.lockedValue)||"0")})),listEmptyMessage:h?" ":void 0,ListItem:function(e){return(0,f.P2PAdvertiseItem)((0,u.default)({isMine:l===e.userId,onPress:function(){return m(e,l===e.userId,t)},advertisePaymentMethods:d(e)},N,e,{side:t}))},loadMore:function(){x&&E&&E({pageParam:{offset:P.pages.flat().length}})},queryKey:["allAdvertises",{side:y}],isFetchingNextPage:k}),Boolean(n)&&i.default.createElement(o.View,{flexDirection:"row",__self:b,__source:{fileName:v,lineNumber:248,columnNumber:9}},i.default.createElement(o.View,{flex:1,__self:b,__source:{fileName:v,lineNumber:249,columnNumber:11}},i.default.createElement(o.Button,{testID:"Button_Create_Advertise",variant:"outline",label:(0,s.$t)("createAd")+" ("+(0,s.$t)(t)+")",onPress:function(){return a.navigate("CreateAdvertise",{side:t})},__self:b,__source:{fileName:v,lineNumber:250,columnNumber:13}}))))},p=function(e){return(0,i.useMemo)((function(){return{buy:i.default.memo((function(){return i.default.createElement(g,(0,u.default)({side:"buy"},e,{__self:b,__source:{fileName:v,lineNumber:270,columnNumber:29}}))})),sell:i.default.memo((function(){return i.default.createElement(g,(0,u.default)({side:"sell"},e,{__self:b,__source:{fileName:v,lineNumber:271,columnNumber:30}}))}))}}),[e])}}}]);