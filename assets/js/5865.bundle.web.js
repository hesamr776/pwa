(self.webpackChunknakhlex=self.webpackChunknakhlex||[]).push([[5865],{12266:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesList=void 0;var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var u=l?Object.getOwnPropertyDescriptor(e,a):null;u&&(u.get||u.set)?Object.defineProperty(n,a,u):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(67294)),l=r(59693),a=r(39698),u=r(80563),i=this,o="/Users/phinix/Workspace/BitBayt/src/features/Chat/components/MessagesList.tsx";function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}t.MessagesList=function(e){var t=e.messages,r=e.loading,s=void 0!==r&&r,f=(0,n.useRef)(null),m=function(){var e;null!=f&&null!=(e=f.current)&&e.scrollToEnd&&(null==t?void 0:t.length)>4&&f.current.scrollToEnd({animated:!0})};return n.default.createElement(l.View,{flex:1,justifyContent:t.length?"flex-end":"center",__self:i,__source:{fileName:o,lineNumber:23,columnNumber:5}},(0,l.List)({inverted:t.length<6,data:t.length<6?t.reverse():t,ref:f,listEmptyMessage:(0,a.$t)("noMessage"),onLayout:m,onContentSizeChange:m,ListItem:u.MessagesListItem,hideSeparator:!0}),s&&n.default.createElement(l.Loading,{__self:i,__source:{fileName:o,lineNumber:35,columnNumber:19}}))}},43014:function(e,t,r){var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesListItem=void 0;var l=n(r(67294)),a=r(59693),u=this,i="/Users/phinix/Workspace/BitBayt/src/features/Chat/components/MessagesListItem.tsx";t.MessagesListItem=function(e){var t=e.isMine,r=e.messageId,n=e.message,o=e.createdAt;return l.default.createElement(a.View,{flex:1,key:r+n+o,__self:u,__source:{fileName:i,lineNumber:11,columnNumber:5}},l.default.createElement(a.View,{key:r,alignSelf:t?"flex-end":"flex-start",style:{backgroundColor:t?"#5AE7FB":"#86EB9C"},borderRadius:12,maxWidth:"70%",minWidth:70,marginHorizontal:"m",paddingVertical:"s",paddingHorizontal:"m",__self:u,__source:{fileName:i,lineNumber:12,columnNumber:7}},l.default.createElement(a.Text,{variant:"body",color:"black",textAlign:"auto",__self:u,__source:{fileName:i,lineNumber:25,columnNumber:9}},n),o&&l.default.createElement(a.Text,{variant:"hint",textAlign:"auto",__self:u,__source:{fileName:i,lineNumber:29,columnNumber:11}},new Date(o).toLocaleTimeString())))}},12722:(e,t,r)=>{var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SendMessage=function(e){var t=e.control,r=e.name,n=e.onPress,s=(0,a.useState)(),f=(0,l.default)(s,2),m=f[0],c=f[1];return(0,a.useEffect)((function(){u.default.addListener("keyboardWillShow",(function(){c("xxl")})),u.default.addListener("keyboardWillHide",(function(){c(void 0)}))}),[]),a.default.createElement(i.View,{flexDirection:"row",alignItems:"center",marginBottom:m,paddingBottom:m,__self:this,__source:{fileName:o,lineNumber:21,columnNumber:5}},a.default.createElement(i.View,{flex:5,marginTop:"s",__self:this,__source:{fileName:o,lineNumber:26,columnNumber:7}},a.default.createElement(i.Input,{name:r,control:t,Append:a.default.createElement(i.View,{width:55,__self:this,__source:{fileName:o,lineNumber:31,columnNumber:13}},a.default.createElement(i.Pressable,{zIndex:1,onPress:n,position:"absolute",justifyContent:"center",alignItems:"center",width:80,height:54,bottom:-27,borderBottomEndRadius:8,borderTopEndRadius:8,right:-17,__self:this,__source:{fileName:o,lineNumber:32,columnNumber:15}},a.default.createElement(i.Image,{name:"send",w:20,h:20,__self:this,__source:{fileName:o,lineNumber:44,columnNumber:17}}))),__self:this,__source:{fileName:o,lineNumber:27,columnNumber:9}})))};var l=n(r(63038)),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var u=l?Object.getOwnPropertyDescriptor(e,a):null;u&&(u.get||u.set)?Object.defineProperty(n,a,u):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(67294)),u=n(r(33668)),i=r(59693),o="/Users/phinix/Workspace/BitBayt/src/features/Chat/components/SendMessage.tsx";function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}},80563:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(12266);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===n[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}}))}));var l=r(12722);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var a=r(43014);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}))},95865:function(e,t,r){var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=n(r(67154)),a=n(r(319)),u=n(r(63038)),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=w(t);if(r&&r.has(e))return r.get(e);var n={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var u=l?Object.getOwnPropertyDescriptor(e,a):null;u&&(u.get||u.set)?Object.defineProperty(n,a,u):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r(67294)),o=r(39698),s=r(59693),f=r(34787),m=r(50599),c=r(80563),d=r(46823),_=r(83965),b=r(39003),p=r(4070),N=r(51222),g=r(62484),v=r(15239),y=this,h="/Users/phinix/Workspace/BitBayt/src/features/Chat/screens/Messages.tsx";function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(w=function(e){return e?r:t})(e)}var E=(0,d.createSchema)({message:(0,d.stringSchema)()}),P=i.default.memo((function(e){var t=e.route,r=t.params,n=r.orderId,d=r.side,_=(0,o.useChat)(),b=_.isReady,p=_.messages,N=void 0===p?[]:p,g=_.userId,w=(0,i.useState)(N),P=(0,u.default)(w,2),O=P[0],x=P[1],j=(0,i.useCallback)((function(e){if(e.sender.userId!==g){var t=[].concat((0,a.default)(O),[e]);x(t.filter((function(e,t,r){return t===r.findIndex((function(t){return t.messageId===e.messageId}))})))}}),[O,g]);(0,v.useFocusEffect)((0,i.useCallback)((function(){return(0,o.joinDialogMessages)(j),function(){(0,o.leaveDialogMessages)()}}),[j]));var k=(0,f.useCustomForm)(E),C=k.control,I=k.handleSubmit,B=k.setValue;return i.default.createElement(s.Screen,{__self:y,__source:{fileName:h,lineNumber:91,columnNumber:5}},i.default.createElement(M,{orderId:n,side:d,__self:y,__source:{fileName:h,lineNumber:92,columnNumber:7}}),i.default.createElement(m.KeyboardAvoiding,{__self:y,__source:{fileName:h,lineNumber:94,columnNumber:7}},i.default.createElement(s.View,{justifyContent:"flex-start",flex:1,__self:y,__source:{fileName:h,lineNumber:95,columnNumber:9}},i.default.createElement(c.MessagesList,{messages:O.map((function(e){var t;return(0,l.default)({},e,{isMine:(null==e||null==(t=e.sender)?void 0:t.userId)===g,id:e.messageId})})),loading:!b,__self:y,__source:{fileName:h,lineNumber:96,columnNumber:11}}),i.default.createElement(c.SendMessage,{control:C,name:"message",onPress:I((function(e){var r=e.message;if(r.trim()){(0,o.sendChatMessage)(r,JSON.stringify(t.params));var n=(new Date).getTime();x([].concat((0,a.default)(O),[{message:r,sender:{userId:g},createdAt:n,id:n}])),B("message","")}})),__self:y,__source:{fileName:h,lineNumber:107,columnNumber:11}}))))}));t.default=P;var M=function(e){var t=e.orderId,r=e.side,n=i.default.useRef(null),a=(0,N.useP2POrderApi)(t).data;return i.default.createElement(s.View,{bg:"white",zIndex:2,flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginHorizontal:"m",paddingTop:"m",paddingBottom:"s",borderBottomWidth:1,borderBottomColor:"gray3",__self:y,__source:{fileName:h,lineNumber:130,columnNumber:5}},i.default.createElement(s.View,{__self:y,__source:{fileName:h,lineNumber:141,columnNumber:7}},i.default.createElement(s.Text,{variant:"hint",__self:y,__source:{fileName:h,lineNumber:142,columnNumber:9}},null!=a&&a.paymentCompletedAt?"sell"===r?(0,o.$t)("pendingForYourRelease"):(0,o.$t)("pendingForRelease"):"buy"===r?(0,o.$t)("pendingForYourPayment"):(0,o.$t)("pendingForPayment")),i.default.createElement(s.View,{flexDirection:"row",alignItems:"center",__self:y,__source:{fileName:h,lineNumber:152,columnNumber:9}},i.default.createElement(s.Text,(0,l.default)({variant:"text",color:"blue"},s.MediumFontProps,{__self:y,__source:{fileName:h,lineNumber:153,columnNumber:11}}),parseFloat((null==a?void 0:a.volume)||"0").toFixed(2)),i.default.createElement(s.Image,{name:"USDT",w:12,h:12,marginHorizontal:"xs",__self:y,__source:{fileName:h,lineNumber:156,columnNumber:11}}))),i.default.createElement(s.View,{__self:y,__source:{fileName:h,lineNumber:160,columnNumber:7}},i.default.createElement(s.Button,{variant:"accent",disabled:"sell"===r&&(!(null!=a&&a.paymentCompletedAt)||(null==a?void 0:a.released))||"buy"===r&&!(null==a||!a.paymentCompletedAt),onPress:function(){var e;return null==(e=n.current)?void 0:e.open()},label:i.default.createElement(s.View,{flexDirection:"row",alignItems:"center",__self:y,__source:{fileName:h,lineNumber:170,columnNumber:13}},i.default.createElement(s.Text,(0,l.default)({variant:"text",color:"primary"},s.MediumFontProps,{marginHorizontal:"s",__self:y,__source:{fileName:h,lineNumber:171,columnNumber:15}}),"sell"===r?(0,o.$t)("release"):(0,o.$t)("pay")),(0,b.P2PTradeTimer)({createdAt:null==a?void 0:a.createdAt,onTimeOver:function(){p.queryClient.invalidateQueries("MyOrders")}})),__self:y,__source:{fileName:h,lineNumber:161,columnNumber:9}})),i.default.createElement(s.BottomSheet,{ref:n,size:"m",noPadding:!0,toggle:null,title:"sell"===r?(0,o.$t)("releaseNow"):(0,o.$t)("didYouPay"),__self:y,__source:{fileName:h,lineNumber:190,columnNumber:7}},"sell"===r?i.default.createElement(_.ReleaseConfirm,{order:a,onConfirm:function(e){var t;null==(t=n.current)||t.close(),e&&p.queryClient.invalidateQueries("P2POrder")},__self:y,__source:{fileName:h,lineNumber:197,columnNumber:11}}):i.default.createElement(g.PayConfirm,{order:a,onConfirm:function(e){var t;null==(t=n.current)||t.close(),e&&p.queryClient.invalidateQueries("P2POrder")},__self:y,__source:{fileName:h,lineNumber:208,columnNumber:11}})))}}}]);